# Owner Portal Updates - October 24, 2025

## Summary

1. Removed unnecessary pages from the Owner Portal to align with the simplified navigation structure
2. Removed percentage display from Application Pipeline Breakdown cards
3. Added required reason field for bulk agency deletion

---

## 1. Owner Portal Cleanup

### Deleted Pages

- **src/pages/OwnerSettings.jsx** - Removed settings page
- **src/pages/OwnerUsers.jsx** - Removed users management page

### Updated Routing (src/App.jsx)

- Removed `/owner/users` route definition
- Removed `/owner/settings` route definition
- Cleaned up imports for `OwnerUsers` and `OwnerSettings` components

### Updated Navigation (src/components/OwnerLayout.jsx)

- Removed "Users" navigation item from sidebar
- Removed "Settings" navigation item from sidebar
- Cleaned up unused icon imports (`Users` and `Settings` from lucide-react)

### Final Owner Portal Structure

The Owner Portal now has a clean, focused navigation with only three main sections:

```
/owner/login (public)
├── /owner/dashboard (protected)
├── /owner/agencies (protected)
└── /owner/analytics (protected)
    └── /owner/analytics/:agencyId (protected - agency details)
```

#### Sidebar Navigation

1. **Dashboard** - Overview metrics and statistics
2. **Agency Management** - View and manage all agencies
3. **Analytics** - Detailed analytics and agency-specific insights

#### Additional UI Elements

- Language switcher
- Theme toggle (dark/light mode)
- User profile display
- Logout button

### Rationale

This cleanup aligns with the Owner Portal specification which defines the portal as a **view-only monitoring/oversight system** with limited administrative actions. The owner's primary functions are:

- Monitor aggregate metrics
- View agency details
- Perform basic agency management (activate/deactivate/delete)
- Analyze performance data

User management and system settings are not part of the core owner responsibilities in this implementation.

---

## 2. Pipeline Breakdown UI Update

### Changes Made

**File:** `src/pages/OwnerAgencyDetails.jsx`

- Removed percentage display from Application Pipeline Breakdown cards
- Cards now only show the count of applicants in each stage
- Removed the line: `<p className="text-xs opacity-80">{stage.percentage}% of total</p>`

### Before

```
Applied
145
100% of total
```

### After

```
Applied
145
```

### Rationale

Simplified the UI to focus on absolute numbers rather than percentages, making the cards cleaner and easier to read at a glance.

---

## 3. Unified Agency Deletion Flow with Reason Requirement

### Changes Made

#### Updated ConfirmationDialog Component

**Files:**

- `src/components/agencies/ConfirmationDialog.jsx` (standalone component)
- `src/pages/OwnerAgencies.jsx` (local ConfirmationDialog component)

**Changes:**

- Added `deleteReason` and `setDeleteReason` props
- Unified both deletion methods (individual delete and bulk delete) to use the same confirmation dialog
- Added dynamic validation based on number of agencies being deleted
- Added textarea field for entering deletion reason (required for all deletions)
- Added confirmation text input field (type "DELETE" for 1 agency, "DELETE ALL" for multiple)
- Delete button is disabled until both fields are properly filled

#### Updated OwnerAgencies Page

**File:** `src/pages/OwnerAgencies.jsx`

- Added `deleteReason` state variable
- Modified `handleDelete` function to use "bulkDelete" type instead of "delete" type
- Both individual and bulk delete now use the same confirmation flow
- Reset `confirmText` and `deleteReason` when opening or closing dialogs
- Updated `confirmDelete` function to work with the new unified flow

#### Updated Translation Files

**Files:**

- `public/translations/en/pages/owner-agencies.json`
- `public/translations/ne/pages/owner-agencies.json`

**Added new translation keys:**

- `confirmDialog.bulkDelete.titleSingle` - "Delete Agency"
- `confirmDialog.bulkDelete.messageSingle` - Message for single agency deletion
- `confirmDialog.bulkDelete.reasonPlaceholderSingle` - Placeholder for single agency
- `confirmDialog.bulkDelete.typeToConfirmSingle` - "Type DELETE to confirm"
- `confirmDialog.bulkDelete.confirmPlaceholderSingle` - "DELETE"
- `confirmDialog.bulkDelete.confirmSingle` - "Delete" button text

### Behavior

**Deleting 1 Agency (any method):**

- Title: "Delete Agency"
- Message: "Are you sure you want to delete '[Agency Name]'? This action cannot be undone."
- Field 1: **Reason for deletion** (textarea) - Required
  - Placeholder: "Please provide a reason for deleting this agency..."
- Field 2: **Type DELETE to confirm** (input) - Required
  - Must type exactly: `DELETE`
- Button: "Delete" (disabled until both fields are valid)

**Deleting 2+ Agencies (bulk selection):**

- Title: "Delete Multiple Agencies"
- Message: "Are you sure you want to delete X agencies? This action cannot be undone."
- Field 1: **Reason for deletion** (textarea) - Required
  - Placeholder: "Please provide a reason for deleting multiple agencies..."
- Field 2: **Type DELETE ALL to confirm** (input) - Required
  - Must type exactly: `DELETE ALL`
- Button: "Delete All" (disabled until both fields are valid)

**Both methods show:**

- Hint: "This action will be logged for audit purposes."

### Rationale

**Unified UI/UX:**

- Consistent deletion experience across all deletion methods
- Reduces user confusion by having one standard deletion flow
- Maintains professional appearance with consistent interactions

**Enhanced Security & Accountability:**

- All deletions require a reason (logged for audit purposes)
- Confirmation text prevents accidental deletions
- Provides audit trail for administrative actions
- Different confirmation text ("DELETE" vs "DELETE ALL") based on severity

**Grammar & Context Awareness:**

- Dynamic text based on number of agencies being deleted
- Singular vs plural grammar handled automatically
- Shows agency name when deleting a single agency
- Shows count when deleting multiple agencies


---

## 4. Unified Status Change Flow with Reason Requirement

### Changes Made

#### Updated ConfirmationDialog Component

**File:** `src/pages/OwnerAgencies.jsx` (local ConfirmationDialog component)

**Changes:**
- Extended the unified confirmation dialog to handle status changes (activate/deactivate)
- Added dynamic validation based on action type (activate vs deactivate)
- Added textarea field for entering reason (required for all status changes)
- Added confirmation text input field (type "ACTIVATE" or "DEACTIVATE" for 1 agency, "ACTIVATE ALL" or "DEACTIVATE ALL" for multiple)
- Button text changes dynamically based on action and count

#### Updated OwnerAgencies Page

**File:** `src/pages/OwnerAgencies.jsx`

- Modified `handleStatusChange` function to use "statusChange" type for both single and bulk operations
- Modified `handleBulkStatusChange` function to reset fields when opening dialog
- Both individual and bulk status changes now use the same confirmation flow
- Updated `confirmBulkStatusChange` function to reset fields after completion

#### Updated Translation Files

**Files:**
- `public/translations/en/pages/owner-agencies.json`
- `public/translations/ne/pages/owner-agencies.json`

**Added new translation keys:**
- `confirmDialog.statusChange.titleSingle` - "{{action}} Agency"
- `confirmDialog.statusChange.messageSingle` - Message for single agency
- `confirmDialog.statusChange.reasonLabel` - "Reason for status change"
- `confirmDialog.statusChange.reasonPlaceholder` - Placeholder for multiple agencies
- `confirmDialog.statusChange.reasonPlaceholderSingle` - Placeholder for single agency
- `confirmDialog.statusChange.typeToConfirm` - "Type {{action}} ALL to confirm"
- `confirmDialog.statusChange.typeToConfirmSingle` - "Type {{action}} to confirm"
- `confirmDialog.statusChange.confirmPlaceholder` - "{{action}} ALL"
- `confirmDialog.statusChange.confirmPlaceholderSingle` - "{{action}}"
- `confirmDialog.statusChange.confirmSingle` - "{{action}}"

### Behavior

**Activating/Deactivating 1 Agency:**
- Title: "Activate Agency" or "Deactivate Agency"
- Message: "Are you sure you want to activate/deactivate '[Agency Name]'?"
- Field 1: **Reason for status change** (textarea) - Required
  - Placeholder: "Please provide a reason for activating/deactivating this agency..."
- Field 2: **Type ACTIVATE or DEACTIVATE to confirm** (input) - Required
  - Must type exactly: `ACTIVATE` or `DEACTIVATE`
- Button: "Activate" or "Deactivate" (disabled until both fields are valid)

**Activating/Deactivating 2+ Agencies:**
- Title: "Activate Multiple Agencies" or "Deactivate Multiple Agencies"
- Message: "Are you sure you want to activate/deactivate X agencies?"
- Field 1: **Reason for status change** (textarea) - Required
  - Placeholder: "Please provide a reason for activating/deactivating multiple agencies..."
- Field 2: **Type ACTIVATE ALL or DEACTIVATE ALL to confirm** (input) - Required
  - Must type exactly: `ACTIVATE ALL` or `DEACTIVATE ALL`
- Button: "Activate All" or "Deactivate All" (disabled until both fields are valid)

**Both methods show:**
- Hint: "This action will be logged for audit purposes."

### Rationale

**Consistent Administrative Actions:**
- All critical administrative actions (delete, activate, deactivate) now follow the same pattern
- Users learn one interaction model that applies to all actions
- Reduces cognitive load and potential for errors

**Enhanced Accountability:**
- Status changes are now tracked with reasons
- Prevents arbitrary status changes without justification
- Provides complete audit trail for all administrative actions
- Helps with compliance and oversight requirements

**Action-Specific Confirmation:**
- Different confirmation text based on action type (ACTIVATE vs DEACTIVATE)
- Clear distinction between activating and deactivating
- Prevents confusion when performing bulk operations


---

## 5. Auto-Refresh for Owner Portal Pages

### Changes Made

#### Updated OwnerLayout Component

**File:** `src/components/OwnerLayout.jsx`

**Changes:**
- Added auto-refresh functionality that triggers every 2 minutes
- Dispatches a custom `ownerPageRefresh` event that pages can listen to
- Added `onRefresh` callback prop for additional refresh handling
- Uses `setInterval` to trigger refresh at 2-minute intervals
- Properly cleans up interval on component unmount

#### Updated Owner Portal Pages

**Files:**
- `src/pages/OwnerDashboard.jsx`
- `src/pages/OwnerAgencies.jsx`
- `src/pages/OwnerAnalytics.jsx`

**Changes:**
- Added event listeners for `ownerPageRefresh` custom event
- Each page reloads its data when the event is triggered
- OwnerAgencies also reloads detail panel if open
- Proper cleanup of event listeners on unmount

### Behavior

**Auto-Refresh Interval:** Every 2 minutes (120,000ms)

**Pages that auto-refresh:**
- `/owner/dashboard` - Reloads statistics and recent activity
- `/owner/agencies` - Reloads agency list, platform stats, and detail panel (if open)
- `/owner/analytics` - Reloads agency list and analytics data

**Pages that DO NOT auto-refresh:**
- `/owner/login` - Login page is excluded from auto-refresh

**Console Logging:**
- Each page logs when it auto-refreshes for debugging purposes
- Format: `[PageName] Auto-refreshing data...`

### Rationale

**Real-Time Data:**
- Owner portal displays critical business metrics that need to be current
- Auto-refresh ensures data is never more than 2 minutes old
- Reduces need for manual page refreshes

**User Experience:**
- Seamless updates without user intervention
- No interruption to user's workflow
- Data stays fresh while user is viewing the portal

**Performance:**
- 2-minute interval balances freshness with server load
- Only refreshes data, not the entire page
- Event-based architecture allows pages to control their own refresh logic

**Excluded Login Page:**
- Login page doesn't need auto-refresh as it's a one-time action
- Prevents unnecessary API calls on the login screen
- Auto-refresh only activates after successful authentication

### Manual Refresh Button

**Added to:** `src/components/OwnerLayout.jsx`

**Features:**
- Refresh icon button (RefreshCw from lucide-react) placed next to language and theme toggles
- Clicking the button immediately triggers a data refresh
- Shows spinning animation while refreshing (1 second)
- Button is disabled during refresh to prevent multiple simultaneous refreshes
- Tooltip shows "Refresh data" (bilingual support)
- Available on all owner portal pages: `/owner/dashboard`, `/owner/agencies`, `/owner/analytics`

**Translation Keys Added:**
- English: `nav.refresh` - "Refresh data"
- Nepali: `nav.refresh` - "डाटा रिफ्रेस गर्नुहोस्"

**User Experience:**
- Users can manually refresh data anytime without waiting for the 2-minute auto-refresh
- Visual feedback with spinning icon during refresh
- Consistent placement across all owner portal pages
